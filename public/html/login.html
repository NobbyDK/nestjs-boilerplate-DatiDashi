<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="description" content="Login - Company Profile Presentation">
  <title>Login - DatiDashi Company</title>
  
  <!-- Stylesheets -->
  <link id="theme-style" rel="stylesheet" href="/themes/default/partials/dark-theme.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <!-- Preconnect for performance -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  
  <!-- Environment Configuration -->
  <script src="/config.js"></script>
</head>
<body>
  <!-- Header -->
  <header>
    <div class="header-container">
      <a href="/" class="logo">
        <img id="logo-img" src="/themes/default/img/gelap.png" alt="Logo svt">
        <h1>datidashi company</h1>
      </a>

      <nav class="nav-grid" id="nav-menu">
        <a href="/html/index.html#hero" class="nav-item">Home</a>
        <a href="/html/index.html#about-section" class="nav-item">About</a>
        <a href="/html/index.html#struktur-section" class="nav-item">Team</a>
        <a href="/html/index.html#produk-section" class="nav-item">Products</a>
        <a href="/html/index.html#feature-section" class="nav-item">Features</a>
        <a href="/html/index.html#pricing-section" class="nav-item">Pricing</a>
        
        <!-- Mobile Only: Login & Theme Toggle -->
        <div class="mobile-only-menu">
          <a href="/html/login.html" class="nav-item login-mobile">üîê Login</a>
          <div class="theme-toggle-mobile">
            <button onclick="setTheme('light')" class="theme-btn-mobile">‚òÄÔ∏è Light</button>
            <button onclick="setTheme('dark')" class="theme-btn-mobile">üåô Dark</button>
          </div>
        </div>
      </nav>

      <div class="theme-toggle">
        <button onclick="setTheme('light')">Light</button>
        <button onclick="setTheme('dark')">Dark</button>
      </div>

      <a href="/html/login.html" class="login-btn">Login</a>

      <button class="menu-toggle" onclick="toggleMenu()">‚ò∞</button>
    </div>
  </header>

  <!-- Login Section -->
  <section class="login-page">
    <div class="login-container">
      <div class="login-card">
        <h2>Login to Admin Panel</h2>
        <p class="login-subtitle">Enter your credentials to access the admin dashboard</p>

        <div id="error-message" class="error-message" style="display: none;"></div>
        <div id="success-message" class="success-message" style="display: none;"></div>

        <form id="login-form" class="login-form">
          <div class="form-group">
            <label for="email">Email</label>
            <input 
              type="email" 
              id="email" 
              name="email" 
              placeholder="admin@example.com"
              required 
            />
          </div>

          <div class="form-group">
            <label for="password">Password</label>
            <input 
              type="password" 
              id="password" 
              name="password" 
              placeholder="Enter your password"
              required 
            />
          </div>

          <button type="submit" class="btn-login" id="login-btn">
            <span class="btn-text">Login</span>
            <span class="btn-loader" style="display: none;">Loading...</span>
          </button>
        </form>

        <div class="login-footer">
          <p>Default admin credentials:</p>
          <p><strong>Email:</strong> admin@example.com</p>
          <p><strong>Password:</strong> admin123 </p>
        </div>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer>
    <div class="container footer-top">
      <div class="row gy-4">
        <div class="col-lg-4 col-md-6 footer-about">
          <a href="/" class="logo d-flex align-items-center">
            <span class="sitename">datidashi company</span>
          </a>
          <div class="footer-contact pt-3">
            <p>CIWARUGA HILIR</p>
            <p>Kabupaten Bandung, 40559</p>
            <p class="mt-3"><strong>Phone:</strong> <span>+62 8888 488 55</span></p>
            <p><strong>Email:</strong> <span>D√†t√≠D√†shƒ´@example.com</span></p>
          </div>
          <div class="social-links d-flex mt-4">
            <a href="#"><i class="fab fa-x"></i></a>
            <a href="#"><i class="fab fa-facebook-f"></i></a>
            <a href="#"><i class="fab fa-instagram"></i></a>
            <a href="#"><i class="fab fa-linkedin-in"></i></a>
          </div>
        </div>

        <div class="col-lg-2 col-md-3 footer-links">
          <h4>Useful Links</h4>
          <ul>
            <li><a href="#">Home</a></li>
            <li><a href="#">About us</a></li>
            <li><a href="#">Services</a></li>
            <li><a href="#">Terms of service</a></li>
            <li><a href="#">Privacy policy</a></li>
          </ul>
        </div>

        <div class="col-lg-2 col-md-3 footer-links">
          <h4>Our Services</h4>
          <ul>
            <li><a href="#">Web Design</a></li>
            <li><a href="#">Web Development</a></li>
            <li><a href="#">Product Management</a></li>
            <li><a href="#">Marketing</a></li>
            <li><a href="#">Graphic Design</a></li>
          </ul>
        </div>

        <div class="col-lg-4 col-md-12 footer-newsletter">
          <h4>Our Newsletter</h4>
          <p>Subscribe to our newsletter and receive the latest news about our products and services!</p>
          <form class="php-email-form" onsubmit="event.preventDefault();">
            <div class="newsletter-form">
              <input type="email" name="email" placeholder="Your Email" disabled>
              <input type="submit" value="Coming Soon" disabled style="cursor: not-allowed; opacity: 0.6;">
            </div>
            <p class="text-muted mt-2" style="font-size: 0.85rem; color: var(--text-secondary);">
              <i class="fas fa-info-circle"></i> Newsletter feature will be available soon
            </p>
          </form>
        </div>
      </div>
    </div>
    <p>&copy; 2025 datidashi company</p>
  </footer>

  <!-- Scripts -->
  <script>
    function toggleMenu() {
      const nav = document.getElementById('nav-menu');
      nav.classList.toggle('show');
    }

    function setTheme(mode) {
      const themeLink = document.getElementById('theme-style');
      const logoImg = document.getElementById('logo-img');

      themeLink.href = `/themes/default/partials/${mode}-theme.css`;

      if (mode === 'dark') {
        logoImg.src = '/themes/default/img/gelap.png';
      } else {
        logoImg.src = '/themes/default/img/terang.png';
      }
    }

    document.getElementById('login-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      const loginBtn = document.getElementById('login-btn');
      const btnText = loginBtn.querySelector('.btn-text');
      const btnLoader = loginBtn.querySelector('.btn-loader');
      const errorMessage = document.getElementById('error-message');
      const successMessage = document.getElementById('success-message');

      // Reset messages
      errorMessage.style.display = 'none';
      successMessage.style.display = 'none';

      // Disable button and show loader
      loginBtn.disabled = true;
      btnText.style.display = 'none';
      btnLoader.style.display = 'inline';

      try {
        const BACKEND_URL = window.ENV?.BACKEND_URL || 'http://localhost:3000';
        console.log('üîµ Login request to:', `${BACKEND_URL}/api/v1/auth/email/login`);
        const response = await fetch(`${BACKEND_URL}/api/v1/auth/email/login`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ email, password }),
        });

        const data = await response.json();

        if (response.ok && data.token) {
          // Store token in localStorage
          localStorage.setItem('authToken', data.token);
          localStorage.setItem('refreshToken', data.refreshToken);
          localStorage.setItem('tokenExpiry', data.tokenExpires);
          
          // Show success message
          successMessage.textContent = 'Login successful! Redirecting to admin panel...';
          successMessage.style.display = 'block';

          // Redirect to admin page after 1 second
          setTimeout(() => {
            window.location.href = '/html/admin.html';
          }, 1000);
        } else {
          // Show error message
          errorMessage.textContent = data.message || 'Login failed. Please check your credentials.';
          errorMessage.style.display = 'block';
          
          // Re-enable button
          loginBtn.disabled = false;
          btnText.style.display = 'inline';
          btnLoader.style.display = 'none';
        }
      } catch (error) {
        console.error('Login error:', error);
        errorMessage.textContent = 'An error occurred. Please try again.';
        errorMessage.style.display = 'block';
        
        // Re-enable button
        loginBtn.disabled = false;
        btnText.style.display = 'inline';
        btnLoader.style.display = 'none';
      }
    });

    // Check if already logged in
    window.addEventListener('DOMContentLoaded', () => {
      const token = localStorage.getItem('authToken');
      if (token) {
        // Verify token is still valid
        const expiry = localStorage.getItem('tokenExpiry');
        if (expiry && new Date(expiry) > new Date()) {
          window.location.href = '/html/admin.html';
        }
      }
    });
  </script>
</body>
</html>
